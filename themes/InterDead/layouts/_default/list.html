{{ define "main" }}
  {{ $isStories := and (eq .Kind "section") (eq .Section "stories") }}
  <section class="gm-section gm-collection{{ if $isStories }} gm-collection--stories{{ end }}">
    <div class="gm-container">
      <header class="gm-collection__header">
        <h1 class="gm-section__title">{{ .Title }}</h1>
        {{ with .Description }}
        <p class="gm-collection__description">{{ . }}</p>
        {{ end }}
      </header>
      {{ $paginator := .Paginate (.Pages.ByDate.Reverse) }}
      <div class="gm-collection__grid">
        {{ range $paginator.Pages }}
        {{ $page := . }}
        {{ $imagePath := $page.Params.image }}
        {{ $cleanPath := cond (and $imagePath (hasPrefix $imagePath "/")) (strings.TrimPrefix "/" $imagePath) $imagePath }}
        {{ $convertedPath := cond $cleanPath (printf "converted-assets/%s" $cleanPath) "" }}
        {{ $imageResource := cond (and $cleanPath (not (hasPrefix $cleanPath "http"))) (or (resources.GetMatch $convertedPath) (resources.GetMatch $cleanPath) ($page.Resources.GetMatch $convertedPath) ($page.Resources.GetMatch $cleanPath)) nil }}
        {{ $resolvedImage := "" }}
        {{ if $imageResource }}
          {{ $resolvedImage = ($imageResource | fingerprint).RelPermalink }}
        {{ else if $imagePath }}
          {{ if hasPrefix $imagePath "http" }}
            {{ $resolvedImage = $imagePath }}
          {{ else }}
            {{ $resolvedImage = $imagePath | absURL }}
          {{ end }}
        {{ end }}
        <article class="gm-card gm-collection__item{{ if $resolvedImage }} gm-card--withMedia{{ end }}">
          {{ with $resolvedImage }}
          <figure class="gm-card__media">
            <img src="{{ . }}" alt="{{ $page.Params.imageAlt | default $page.Title }}" loading="lazy" />
          </figure>
          {{ end }}
          <div class="gm-card__content">
            {{ partial "components/category-list.html" (dict "categories" $page.Params.categories "class" "gm-card__categories" "label" (i18n "blog.categories")) }}
            <h2 class="gm-collection__itemTitle"><a href="{{ $page.RelPermalink }}">{{ $page.Title }}</a></h2>
            <div class="gm-card__meta">
              {{ with $page.Date }}
              <p class="gm-text--fine gm-card__date">{{ .Format "02 Jan 2006" }}</p>
              {{ end }}
            </div>
            {{ with $page.Summary }}
            <p class="gm-card__summary">{{ . }}</p>
            {{ end }}
            <a class="gm-link" href="{{ $page.RelPermalink }}">{{ i18n "blog.readMore" }}</a>
          </div>
        </article>
        {{ end }}
      </div>
      {{ template "_internal/pagination.html" $paginator }}
    </div>
  </section>
{{ end }}

{{- $id := printf "efbd-poll-%d" now.UnixNano -}} {{- $styleAsset := resources.Get
"mini-games/efbd-poll/styles.css" | fingerprint -}} {{- $mapAsset := resources.Get
"mini-games/efbd-poll/The-Tower.webp" | fingerprint -}} {{- $scriptOptions := dict "targetPath"
"js/mini-games/efbd-poll.js" "format" "esm" "minify" (not hugo.IsServer) -}} {{- $scriptAsset :=
resources.Get "mini-games/efbd-poll/poll.js" | js.Build $scriptOptions | fingerprint -}} {{-
$runtimeOptions := dict "targetPath" "js/mini-games/runtime.js" "format" "esm" "minify" (not
hugo.IsServer) -}} {{- $runtimeAsset := resources.Get "js/application/minigame/runtime.js" |
js.Build $runtimeOptions | fingerprint -}} {{- $options := slice (dict "axis" "EBF-SOCIAL" "label"
(i18n "minigames.poll.option.social") "i18nKey" "minigames.poll.option.social") (dict "axis"
"EBF-MIND" "label" (i18n "minigames.poll.option.mind") "i18nKey" "minigames.poll.option.mind") (dict
"axis" "EBF-EXPOSURE" "label" (i18n "minigames.poll.option.exposure") "i18nKey"
"minigames.poll.option.exposure") -}} {{- $strings := dict "title" (i18n "minigames.poll.title")
"prompt" (i18n "minigames.poll.prompt") "submit" (i18n "minigames.poll.submit") "success" (i18n
"minigames.poll.success") "error" (i18n "minigames.poll.error") "required" (i18n
"minigames.poll.required") "mapAlt" (i18n "minigames.poll.mapAlt") "mapUrl" $mapAsset.RelPermalink
-}} {{- $stringKeys := dict "title" "minigames.poll.title" "prompt" "minigames.poll.prompt" "submit"
"minigames.poll.submit" "success" "minigames.poll.success" "error" "minigames.poll.error" "required"
"minigames.poll.required" "mapAlt" "minigames.poll.mapAlt" -}} {{- if not ($.Page.Scratch.Get
"miniGameRuntimeInjected") -}}
<script
  type="module"
  src="{{ $runtimeAsset.RelPermalink }}"
  integrity="{{ $runtimeAsset.Data.Integrity }}"
  crossorigin="anonymous"
></script>
{{- $.Page.Scratch.Set "miniGameRuntimeInjected" true -}} {{- end -}}

<div
  class="gm-minigame gm-minigame--poll"
  id="{{ $id }}"
  data-minigame-root
  data-map-url="{{ $mapAsset.RelPermalink }}"
>
  <div class="gm-minigame__fallback" data-minigame-fallback data-i18n="profile.unauthenticated">
    {{ i18n "profile.unauthenticated" }}
  </div>
  <div class="gm-minigame__mount" data-minigame-mount hidden></div>
</div>
<script>
  window.InterdeadMiniGamesQueue = window.InterdeadMiniGamesQueue || [];
  window.InterdeadMiniGamesQueue.push({
    rootId: {{ $id | jsonify }},
    assets: {
      styleUrl: {{ $styleAsset.RelPermalink | jsonify }},
      styleIntegrity: {{ $styleAsset.Data.Integrity | jsonify }},
      scriptUrl: {{ $scriptAsset.RelPermalink | jsonify }}
    },
    options: {{ $options | jsonify }},
    strings: {{ $strings | jsonify }},
    stringKeys: {{ $stringKeys | jsonify }},
    mapUrl: {{ $mapAsset.RelPermalink | jsonify }},
    locale: {{ .Site.Language.Lang | jsonify }}
  });
</script>
